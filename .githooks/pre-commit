#!/bin/sh
#
# Pre-commit hook: Block modifications to existing test files
# Tests are source of truth - fix implementation, not tests
#

# Get list of staged test files
STAGED_TEST_FILES=$(git diff --cached --name-only --diff-filter=M | grep -E '\.(test|spec)\.(ts|tsx|js|jsx)$' || true)

if [ -n "$STAGED_TEST_FILES" ]; then
  echo "‚ùå COMMIT BLOCKED: Do not modify tests; fix implementation."
  echo ""
  echo "The following test files have staged modifications:"
  echo "$STAGED_TEST_FILES" | sed 's/^/  - /'
  echo ""
  echo "Tests are the source of truth. Please:"
  echo "  1. Unstage test file changes: git restore --staged <test-file>"
  echo "  2. Fix the implementation to satisfy existing tests"
  echo ""
  echo "New test files can be added, but existing tests cannot be modified."
  exit 1
fi

exit 0
